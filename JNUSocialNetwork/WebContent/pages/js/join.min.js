!function(t){"use strict";function s(){t.getJSON(n).done(function(n){for(var i in n)t.getJSON(e+n[i]).done(d)})}function c(){t("#activity-list").delegate(".join-btn","click",function(e){if(!window.USERID)return void t("#remindModal").modal("show");var n=t(e.currentTarget),i=o[n.data("postid")];t.inArray(window.USERID,i.participantIDs)>=0?l(n):r(n)}),t(".account-link").click(function(t){localStorage.setItem("url",window.location.href),window.location.href=t.currentTarget.getAttribute("href"),console.log(window.location.href)})}function r(e){var n=[i,window.USERID,"/",e.data("postid")].join("");t.ajax(n,{type:"PUT",processData:!1,contentType:!1,beforeSend:function(t){t.setRequestHeader("ID",USERID)},success:function(n,i){console.log("join succeed! "+i),f(e),p(t("#successAlert"),"亲！你已成功加入该活动"),u(e.data("postid"))},error:function(e,n,i){console.log("join failed! "+n+" "+i),p(t("#errorAlert"),"未知错误，加入失败，抱歉！")}})}function l(e){var n=[a,window.USERID,"/",e.data("postid")].join("");t.ajax(n,{type:"PUT",processData:!1,contentType:!1,beforeSend:function(t){t.setRequestHeader("ID",USERID)},success:function(n,i){console.log("leave succeed "+i),f(e),p(t("#successAlert"),"亲！很遗憾你放弃了参加这次活动！"),u(e.data("postid"))},error:function(e,n,i){console.log("leave failed! "+n+" "+i),p(t("#errorAlert"),"亲！未知错误，上天也阻止你放弃啊！")}})}function u(n){t.getJSON(e+n).done(function(t){o[t.ID]=t})}function f(t){t.hasClass("btn-success")?t.removeClass("btn-success").addClass("btn-danger").html("离开"):t.removeClass("btn-danger").addClass("btn-success").html("参加")}function d(e){var n={activityAddr:e.attributes.activityAddr,activityMore:e.attributes.activityMore,activityName:e.attributes.activityName,activityTime:e.attributes.activityTime,imgsrc:JSON.parse(e.attributes.background).src,ID:e.ID};o[e.ID]=e;var i=_.template(t("#li-template").html())(n),a=t(i);t.inArray(window.USERID,e.participantIDs)>=0&&f(t(".join-btn",a)),console.log(a.get(0)),t("#activity-list").append(a[0])}function p(e,n){n&&t("p",e).html(n),e.fadeIn(500),setTimeout(function(){e.fadeOut(500)},4e3)}var e="/app/post/fetchByID/",n="/pages/assets/postID.json",i="/app/post/joinActivity/",a="/app/post/leaveActivity/",o={};t(document).ready(function(){_.templateSettings={evaluate:/<@([\s\S]+?)@>/g,interpolate:/<@=([\s\S]+?)@>/g,escape:/<@-([\s\S]+?)@>/g},s(),c()})}(jQuery);